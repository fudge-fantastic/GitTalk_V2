generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Single-user mode: removed User model. All data is global.

model Repo {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  githubUrl String   @unique
  name      String
  description String?

  projects  Project[]
  commits   RepoCommit[]
}

model Project {
  id           String   @id @default(cuid())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  projectName  String
  description  String?
  repoId       String

  // RAG / indexing status
  ragStatus       IndexingStatus @default(IDLE)
  lastIndexedAt   DateTime?
  indexingError   String?
  vectorCount     Int @default(0)
  embeddingProvider String?
  vectorStore       String?

  repo       Repo   @relation(fields: [repoId], references: [id], onDelete: Cascade)
  @@index([repoId])
}

enum IndexingStatus {
  IDLE
  PENDING
  INDEXING
  READY
  ERROR
  DISABLED
  STALE
}



model RepoCommit {
  id              String   @id @default(cuid())
  commitHash      String
  commitMessage   String
  commitUrl       String
  authorName      String
  authorUrl       String
  authorAvatarUrl String
  committedAt     DateTime

  repoId          String
  repo            Repo     @relation(fields: [repoId], references: [id], onDelete: Cascade)
  @@index([commitHash])
  @@unique([repoId, commitHash])
  @@index([repoId, committedAt])
}

// Local-only preferences (extend later for multi-user)
// UserPreference removed (single-user mode); replace with future Config table if needed.

// Stored environment-like key/value credentials (single-user local mode)
// NOTE: These are NOT automatically merged into process.env at runtime.
// Access via prisma.envVar or a helper loader. Do NOT use for production secrets without
// adding encryption at rest and access controls.
model EnvVar {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  key       String
  value     String

  @@unique([key])
}

